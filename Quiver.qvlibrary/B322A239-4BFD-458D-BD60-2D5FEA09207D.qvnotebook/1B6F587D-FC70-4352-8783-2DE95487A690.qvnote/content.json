{
  "title": "SQL",
  "cells": [
    {
      "type": "text",
      "data": "<div>查询验证不通过的银行卡</div><div>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>tbfv.bank_account_id, tlo.apply_code, tbfv.holder_name, tbfv.mobile, tbfv.holder_id_card_num, tbfv.bank_account_no, tb.`name`,&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>tbfv.verfiy_status, tbfv.error_code, tbfv.failure_detail</div><div>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>t_bank_factor_verify tbfv</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_bank_account tba ON tbfv.bank_account_id = tba.id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_bank tb ON tbfv.bank_code = tb.`code`</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_loan_order tlo ON tba.loan_order_id = tlo.id</div><div>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>tbfv.verfiy_status != 'PASS'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND tlo.`status` IN (1,2,3,4,5,6);</div><div><br></div><div><br></div><div>— 查询扣款成功的记录</div><div><div>(</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>SELECT -- sum( trans.amount ),</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>res.out_id ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>usr.NAME ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>CONCAT(' ', trans.payer_bank_account, ' '),</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>(SELECT NAME FROM t_bank WHERE `code` = trans.payer_bank_code) AS bank_name,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>trans.amount,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>res.remark&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>FROM `t_channel_withhold_result` res ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>t_trans trans ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>t_loan_user usr&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>WHERE&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>res.out_id LIKE 'WHF%'&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>AND res.STATUS IN(2 , 4) -- AND &nbsp;res.remark not like '%足%' &nbsp;-- 成功记录</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>-- &nbsp; AND &nbsp;res.status !=2</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>AND trans.id = res.trans_id AND trans.payer_user_id = usr.id&nbsp;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AND res.created_time BETWEEN '2017-02-01 00:00:00' AND '2017-02-01 23:59:59'</div><div>) UNION(</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>SELECT mcs.out_no ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>mcs.holder_name ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>CONCAT(' ', mcs.bank_account, ' ') ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>(SELECT NAME FROM t_bank WHERE `code` = mcs.bank_code) AS bank_name ,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>mcs.amount,</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>mcs.remark&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>FROM manual_cash_serial mcs&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>WHERE mcs.`status` = 3&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND mcs.channel_type = 3&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND mcs.created_time BETWEEN '2017-02-01 00:00:00' AND '2017-02-01 23:59:59'</div><div>)</div></div><div>in 2504 msec}<br></div><div><a href=\"http://idea.imsxm.com/\">http://idea.imsxm.com/</a><br></div><div><br></div><div><br></div><div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>SELECT DISTINCT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>*</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>t_tc_trade trade</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>trade.create_time &gt; '2017-03-07 07:00:00'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.id NOT IN&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>(</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>SELECT DISTINCT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>a.transaction_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>(</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t</span>(</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t</span>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t\t</span>transaction_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t</span>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t\t</span>fdd_finance.fin_receivable</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t</span>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t\t</span>create_time &gt; '2017-03-07 07:00:00' and transaction_id &lt;&gt; 'null' AND transaction_id IS NOT NULL</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t</span>)</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t</span>UNION</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t</span>(</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t</span>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t\t</span>transaction_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t</span>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t\t</span>fdd_finance.fin_payable</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t</span>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t\t\t</span>create_time &gt; '2017-03-07 07:00:00' and transaction_id &lt;&gt; 'null' AND transaction_id IS NOT NULL</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t\t</span>)&nbsp;</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t\t</span>) a</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>)</div></div><div><br></div><div><br></div><div><br></div><div><br></div><div><div><br></div><div>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>tc_order.customer_name, tc_order.customer_mobile, action.buiness_time, trade.actual_amount, trade.id</div><div>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>t_tc_order tc_order</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_trade trade ON trade.order_id = tc_order.order_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_status order_status ON order_status.order_id = tc_order.order_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_product product ON product.order_id = tc_order.order_id</div><div>&nbsp;<span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_action action ON action.order_id = tc_order.order_id</div><div>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>order_status.order_status IN (2,3,4)</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.trans_type = 2 AND trade.fee_type IN (3, 4, 5)</div><div>&nbsp;<span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND action.buiness_time &gt; '2017-03-19 00:00:00' AND action.buiness_time &lt; '2017-03-19 23:59:59'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND action.new_status = 2</div><div>-- <span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND tc_order.create_time &gt; '2017-03-19 00:00:00' AND tc_order.create_time &lt; '2017-03-19 23:59:59'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND product.house_id = 22727</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.id NOT IN (</div><div>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>trade.id</div><div>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>t_tc_order tc_order</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_trade trade ON trade.order_id = tc_order.order_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_status order_status ON order_status.order_id = tc_order.order_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_product product ON product.order_id = tc_order.order_id</div><div>&nbsp;<span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_action action ON action.order_id = tc_order.order_id</div><div>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>order_status.order_status IN (2,3,4)</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.trans_type = 2 AND trade.fee_type IN (3, 4, 5)</div><div>&nbsp;<span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND action.buiness_time &gt; '2017-03-19 00:00:00' AND action.buiness_time &lt; '2017-03-19 23:59:59'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND action.new_status = 2</div><div>-- <span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND tc_order.create_time &gt; '2017-03-19 00:00:00' AND tc_order.create_time &lt; '2017-03-19 23:59:59'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND product.house_id = 22727</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.actual_amount &gt; 0</div><div>)</div><div>ORDER BY trade.id;</div><div><br></div><div><br></div><div>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>tc_order.customer_name, tc_order.customer_mobile, action.buiness_time, trade.actual_amount, trade.id</div><div>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>t_tc_order tc_order</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_trade trade ON trade.order_id = tc_order.order_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_status order_status ON order_status.order_id = tc_order.order_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_product product ON product.order_id = tc_order.order_id</div><div>&nbsp;<span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_tc_order_action action ON action.order_id = tc_order.order_id</div><div>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>order_status.order_status IN (2,3,4)</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.trans_type = 2 AND trade.fee_type IN (3, 4, 5)</div><div>&nbsp;<span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND action.buiness_time &gt; '2017-03-19 00:00:00' AND action.buiness_time &lt; '2017-03-19 23:59:59'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND action.new_status = 2</div><div>-- <span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND tc_order.create_time &gt; '2017-03-19 00:00:00' AND tc_order.create_time &lt; '2017-03-19 23:59:59'</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND product.house_id = 22727</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND trade.actual_amount &gt; 0</div><div>ORDER BY trade.id;</div></div><div><br></div><div><br></div><div><div>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>terminal_id, payer_account, third_party_serial_no, transaction_id</div><div>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>fdd_finance.fin_receipt receipt</div><div>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>receipt.transaction_id IN (</div><div><br></div><div>)</div><div>ORDER BY transaction_id;</div></div><div><br></div><div><br></div><div><br></div><div><div>多多惠使用统计</div><div>SELECT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>temp.house_id, temp.city_name, temp.house_name, sum(bug_amount)</div><div>FROM</div><div>(</div><div>SELECT DISTINCT</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>t_order.id, t_city.city_name,t_house.id as house_id, &nbsp;t_house.house_name, t_order.bug_amount-- , t_user.user_name</div><div>FROM</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>coupon_order t_order</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN coupon_order_item t_item ON t_item.coupon_id = t_order.id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN finance_account t_account ON t_account.user_id = t_item.user_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_coupon_code t_code ON t_code.coupon_id = t_order.id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_city ON t_city.id = t_order.city_id</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>INNER JOIN t_house_info t_house ON t_order.house_id = t_house.id</div><div>WHERE</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>t_order.`status` IN ('00','01')</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND t_house.id NOT IN (30, 37, 45)</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND t_city.id NOT IN (54)</div><div><span class=\"Apple-tab-span\" style=\"white-space:pre\">\t</span>AND t_order.create_time &gt; \"2015-01-01\"</div><div>) temp&nbsp;</div><div>GROUP BY house_id</div></div>"
    }
  ]
}